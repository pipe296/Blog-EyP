<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Documento sin título</title>
    <style type="text/css">
<!--
p.MsoNormal {
margin-top:0cm;
margin-right:0cm;
margin-bottom:10.0pt;
margin-left:0cm;
line-height:115%;
font-size:11.0pt;
font-family:"Calibri","sans-serif";
}
-->
</style> <style type="text/css">
<!--
table.MsoNormalTable {
font-size:10.0pt;
font-family:"Calibri","sans-serif";
}
-->
</style> <script type="text/javascript">
	document.oncontextmenu = function(){return false;}
    function disabletext(e){
    return false
    }
    function reEnable(){
    return true
    }
    document.onselectstart=new Function ("return false")
    if (window.sidebar){
    document.onmousedown=disabletext
    document.onclick=reEnable
    }
</script> <style type="text/css">
<!--
p.MsoListParagraph {
margin-top:0cm;
margin-right:0cm;
margin-bottom:10.0pt;
margin-left:36.0pt;
line-height:115%;
font-size:11.0pt;
font-family:"Calibri","sans-serif";
}
p.MsoNormal1 {	margin-top: 0cm;
	margin-right: 0cm;
	margin-bottom: 10.0pt;
	margin-left: 0cm;
	line-height: 115%;
	font-size: 12pt;
	font-family: Arial, sans-serif;
}
-->
</style> </head>
  <body> <strong><span style="font-family:'Arial','sans-serif'; font-size:12.0pt; ">Convertidor
        D/A con PWM</span></strong>
    <p class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;line-height:normal;background:white;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;line-height:normal;background:white;"><img
        src="../img/PWM%20motor%20DC%20220V.png" alt="" height="616" width="916"></p>
    <p class="MsoNormal" style="margin-bottom:.0001pt;text-align:justify;line-height:normal;background:white;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Hay
      proyectos en los que tenemos que controlar el nivel de voltaje como: la
      referencia de una fuente regulada, la salida de audio, o bien queremos
      hacer nuestro generador de funciones. Pero estas señales son analógicas y
      la mayoría de los microcontroladores de gama baja y media (PICs, AVRs,
      etc) no tienen un convertidor DAC.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Una
      solución muy frecuente es usar un circuito DAC (convertidor digital
      analógico) aparte del micro controlador, lo que es muy útil, pero tiene
      dos inconvenientes: es un circuito mas, lo que es mas espacio y costo,
      aparte de que puede requerir muchas lineas de señales por parte de nuestro
      procesador, en el caso de que la interfaz sea paralela.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Pero
      todos los microcontroladores tienen por lo menos un timer y en la mayoria
      de los casos se puede usar como un modulador de ancho de pulso (PWM) En el
      caso de que se cuente con estos recursos. se puede usar el timer/PWM para
      hacer conversiones de digital a analogico usando un arreglo de una
      resistencia, un capacitor y un amplificador operacional.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;"><img
        src="../img/PWM%20DAC_1.png" alt="" height="307" width="558"></p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">El
      circuito es un filtro pasabaja de primer orden y el amplificador
      operacional sirve para evitar que se caiga el voltaje de salida debido a
      la carga que le coloquemos.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Sin
      adentrarnos mucho en el tema, los filtros pasabaja dejan pasar las señales
      con frecuencia menor a la frecuencia de corte. En pocas palabras, de la
      frecuencia de corte para abajo. Para calcular la frecuencia de corte, en
      este caso se puede usar la siguiente formula: <img src="../img/PWM%20DAC_3.png"
        alt="" height="28" width="80"></p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;"><img
        src="../img/PWM%20DAC_2.png" alt="" height="250" width="558"></p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Esta
      frecuencia de corte es importante, ya que nos da la pauta de las
      frecuencias que podemos suministrar como señal de salida analógica. Es
      decir, si nuestra frecuencia de corte es de 1000Hz, con nuestro dac pwm
      podemos sacar frecuencias menores de 1000Hz, por ejemplo podemos sacar
      senoidales a 600Hz sin problema.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Ahora
      bien, ya tenemos la frecuencia de corte, pero hace falta otra frecuencia
      importante a considerar, que es la frecuencia del PWM. La frecuencia del
      pwm es la que usara el timer para generar la señal de salida analógica. No
      podemos elegir una frecuencia de pwm menor que la frecuencia de corte del
      filtro, ya que prácticamente solo veríamos la señal del timer. Tampoco
      podemos igualarla con la de corte ya que la señal de salida presentaría
      mucho ruido debido a que la atenuación empieza en la frecuencia de corte,
      es decir, todavía veríamos la señal del timer en la salida analógica.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">
      Debemos elegir una frecuencia de pwm mucho mayor que la frecuencia de
      corte, para asegurar que la frecuencia del timer no llegue a la salida de
      nuestro convertidor ya que estaría muy atenuada según nuestro filtro.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">Es
      recomendable utilizar frecuencias de pwm por lo menos 20 veces mas alta
      que la frecuencia de corte. De hecho, generalmente empezaremos viendo cual
      es la frecuencia máxima de pwm que podemos tener en el timer/pwm y de allí
      propondremos la frecuencia de corte. Al final la velocidad del
      microprocesador es nuestro limite.</p>
    <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; line-height: normal; background: white; font-size: 12pt;">&nbsp;</p>
    <pre><font color="#434f54">// include the library code:</font>
<font color="#5e6d03">#include</font> <font color="#434f54">&lt;</font><b><font
color="#d35400">LiquidCrystal</font></b><font color="#434f54">.</font><font color="#000000">h</font><font
color="#434f54">&gt;</font>

<font color="#00979c">const</font> <font color="#00979c">int</font> <font color="#000000">rs</font> <font
color="#434f54">=</font> <font color="#000000">12</font><font color="#434f54">,</font> <font
color="#000000">en</font> <font color="#434f54">=</font> <font color="#000000">11</font><font
color="#434f54">,</font> <font color="#000000">d4</font> <font color="#434f54">=</font> <font
color="#000000">5</font><font color="#434f54">,</font> <font color="#000000">d5</font> <font
color="#434f54">=</font> <font color="#000000">4</font><font color="#434f54">,</font> <font
color="#000000">d6</font> <font color="#434f54">=</font> <font color="#000000">3</font><font
color="#434f54">,</font> <font color="#000000">d7</font> <font color="#434f54">=</font> <font
color="#000000">2</font><font color="#000000">;</font>
<b><font color="#d35400">LiquidCrystal</font></b> <font color="#000000">lcd</font><font
color="#000000">(</font><font color="#000000">rs</font><font color="#434f54">,</font> <font
color="#000000">en</font><font color="#434f54">,</font> <font color="#000000">d4</font><font
color="#434f54">,</font> <font color="#000000">d5</font><font color="#434f54">,</font> <font
color="#000000">d6</font><font color="#434f54">,</font> <font color="#000000">d7</font><font
color="#000000">)</font><font color="#000000">;</font>

<font color="#00979c">long</font> <font color="#000000">sensor</font> <font color="#434f54">=</font> <font
color="#000000">0</font><font color="#000000">;</font>

<font color="#00979c">void</font> <font color="#5e6d03">setup</font><font color="#000000">(</font><font
color="#000000">)</font> <font color="#000000">{</font>
 &nbsp;<font color="#d35400">digitalWrite</font><font color="#000000">(</font><font
color="#000000">10</font><font color="#434f54">,</font> <font color="#00979c">HIGH</font><font
color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">lcd</font><font color="#434f54">.</font><font color="#d35400">begin</font><font
color="#000000">(</font><font color="#000000">16</font><font color="#434f54">,</font><font
color="#000000">2</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#d35400">delay</font><font color="#000000">(</font><font color="#000000">200</font><font
color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">lcd</font><font color="#434f54">.</font><font color="#d35400">setCursor</font><font
color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font><font
color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">lcd</font><font color="#434f54">.</font><font color="#d35400">print</font><font
color="#000000">(</font><font color="#005c5f">"PWM: 0"</font><font color="#000000">)</font><font
color="#000000">;</font>
<font color="#000000">}</font>

<font color="#00979c">void</font> <font color="#5e6d03">loop</font><font color="#000000">(</font><font
color="#000000">)</font> <font color="#000000">{</font>
 &nbsp;<font color="#000000">sensor</font> <font color="#434f54">=</font> <font
color="#d35400">analogRead</font><font color="#000000">(</font><font color="#000000">A0</font><font
color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">sensor</font> <font color="#434f54">=</font> <font
color="#d35400">map</font><font color="#000000">(</font><font color="#000000">sensor</font><font
color="#434f54">,</font><font color="#000000">0</font><font color="#434f54">,</font><font
color="#000000">1023</font><font color="#434f54">,</font><font color="#000000">0</font><font
color="#434f54">,</font><font color="#000000">255</font><font color="#000000">)</font><font
color="#000000">;</font>

 &nbsp;<font color="#000000">lcd</font><font color="#434f54">.</font><font color="#d35400">setCursor</font><font
color="#000000">(</font><font color="#000000">5</font><font color="#434f54">,</font><font
color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">lcd</font><font color="#434f54">.</font><font color="#d35400">print</font><font
color="#000000">(</font><font color="#000000">sensor</font><font color="#000000">)</font><font
color="#000000">;</font>
 &nbsp;<font color="#000000">lcd</font><font color="#434f54">.</font><font color="#d35400">print</font><font
color="#000000">(</font><font color="#005c5f">" &nbsp;"</font><font color="#000000">)</font><font
color="#000000">;</font>
 &nbsp;<font color="#d35400">analogWrite</font><font color="#000000">(</font><font
color="#000000">9</font><font color="#434f54">,</font> <font color="#000000">sensor</font><font
color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#d35400">delay</font><font color="#000000">(</font><font color="#000000">50</font><font
color="#000000">)</font><font color="#000000">;</font>
<font color="#000000">}</font></pre>
  </body>
</html>
